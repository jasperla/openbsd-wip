$OpenBSD$
--- third_party/devscripts/licensecheck.pl.orig	Wed Nov 23 15:30:00 2011
+++ third_party/devscripts/licensecheck.pl	Wed Nov 23 15:30:00 2011
@@ -241,6 +241,12 @@ my @files = ();
 my @find_args = ();
 my $files_count = @ARGV;
 
+push @find_args, qw(-not ( -path */LayoutTests/* -prune ) );
+push @find_args, qw(-not ( -path */out/Debug/* -prune ) );
+push @find_args, qw(-not ( -path */out/Release/* -prune ) );
+push @find_args, qw(-not ( -path *.git* -prune ) );
+push @find_args, qw(-not ( -path *.svn* -prune ) );
+
 push @find_args, qw(-maxdepth 1) unless $opt_recursive;
 push @find_args, qw(-follow -type f -print);
 
@@ -277,10 +283,6 @@ while (@files) {
     while (<F>) {
         last if ($. > $opt_lines);
         $content .= $_;
-	$copyright_match = parse_copyright($_);
-	if ($copyright_match) {
-	    $copyrights{lc("$copyright_match")} = "$copyright_match";
-	}
     }
     close(F);
 
@@ -298,7 +300,6 @@ while (@files) {
 
     $license = parselicense($content);
     print "$file: ";
-    print "*No copyright* " unless $copyright;
     print $license . "\n";
     print "  [Copyright: " . $copyright . "]\n"
       if $copyright and $opt_copyright;
@@ -398,10 +399,6 @@ sub parselicense($) {
 	$gplver = " (v$1 or later)";
     }
 
-    if ($licensetext =~ /(?:675 Mass Ave|59 Temple Place|51 Franklin Steet|02139|02111-1307)/i) {
-	$extrainfo = " (with incorrect FSF address)$extrainfo";
-    }
-
     if ($licensetext =~ /permission (?:is (also granted|given))? to link (the code of )?this program with (any edition of )?(Qt|the Qt library)/i) {
 	$extrainfo = " (with Qt exception)$extrainfo"
     }
@@ -414,20 +411,12 @@ sub parselicense($) {
 	$license = "LGPL$gplver$extrainfo $license";
     }
 
-    if ($licensetext =~ /is free software.? you can redistribute it and\/or modify it under the terms of the (GNU Affero General Public License|AGPL)/i) {
-	$license = "AGPL$gplver$extrainfo $license";
-    }
-
     if ($licensetext =~ /is free software.? you (can|may) redistribute it and\/or modify it under the terms of (?:version [^ ]+ (?:\(?only\)? )?of )?the GNU General Public License/i) {
 	$license = "GPL$gplver$extrainfo $license";
-    }
-
-    if ($licensetext =~ /is distributed under the terms of the GNU General Public License,/
+    } elsif ($licensetext =~ /is distributed under the terms of the GNU General Public License,/
 	and length $gplver) {
 	$license = "GPL$gplver$extrainfo $license";
-    }
-
-    if ($licensetext =~ /is distributed.*terms.*GPL/) {
+    } elsif ($licensetext =~ /is distributed.*terms.*GPL/) {
 	$license = "GPL (unversioned/unknown version) $license";
     }
 
@@ -450,15 +439,21 @@ sub parselicense($) {
     }
 
     if ($licensetext =~ /THIS SOFTWARE IS PROVIDED .*AS IS AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY/) {
-	if ($licensetext =~ /All advertising materials mentioning features or use of this software must display the following acknowledge?ment.*This product includes software developed by/i) {
+	if ($licensetext =~ /All advertising materials mentioning features or use of this software must display the following/) {
 	    $license = "BSD (4 clause) $license";
-	} elsif ($licensetext =~ /(The name .*? may not|Neither the names? .*? nor the names of (its|their) contributors may) be used to endorse or promote products derived from this software/i) {
+	} elsif ($licensetext =~ /be used to endorse or promote products derived from this software/) {
 	    $license = "BSD (3 clause) $license";
-	} elsif ($licensetext =~ /Redistributions of source code must retain the above copyright notice/i) {
+	} elsif ($licensetext =~ /Redistributions of source code must retain the above copyright notice/) {
 	    $license = "BSD (2 clause) $license";
 	} else {
 	    $license = "BSD $license";
 	}
+    } elsif ($licensetext =~ /Use of this source code is governed by a BSD-style license/) {
+        $license = "BSD-like $license";
+    } elsif ($licensetext =~ /BSD terms apply/) {
+        $license = "BSD-like $license";
+    } elsif ($licensetext =~ /GOVERNED BY A BSD-STYLE SOURCE LICENSE/) {
+        $license = "BSD-like $license";
     }
 
     if ($licensetext =~ /Mozilla Public License Version ([^ ]+)/) {
@@ -477,7 +472,9 @@ sub parselicense($) {
 	$license = "Perl $license";
     }
 
-    if ($licensetext =~ /under the Apache License, Version ([^ ]+)/) {
+    if ($licensetext =~ /under the terms of the Apache ([^ ]+) License OR version 2 of the GNU/) {
+	$license = "Apache (v$1) GPL (v2) $license";
+    } elsif ($licensetext =~ /under the Apache License, Version ([^ ]+)/) {
 	$license = "Apache (v$1) $license";
     }
 
@@ -493,11 +490,11 @@ sub parselicense($) {
 	$license = "CeCILL-$1 $license";
     }
 
-    if ($licensetext =~ /under the SGI Free Software License B/) {
+    if ($licensetext =~ /under the SGI Free Software (B License|License B)/) {
 	$license = "SGI Free Software License B $license";
     }
 
-    if ($licensetext =~ /is in the public domain/i) {
+    if ($licensetext =~ /in the public domain/i) {
 	$license = "Public domain";
     }
 
@@ -509,6 +506,13 @@ sub parselicense($) {
         $license = "Ms-PL $license";
     }
 
+    if ($licensetext =~ /as defined in and that are subject to the Apple Public Source License([ ,-]+Version ([^ ]+)?(\.))/) {
+	$license = "APSL " . ($1 ? "(v$2) " : '') . $license;
+    } elsif ($licensetext =~ /provided that if you redistribute the Apple Software in its entirety and without modifications, you must retain this notice and the following text and disclaimers in all such redistributions of the Apple Software/) {
+	# https://fedoraproject.org/wiki/Licensing/Apple_MIT_License
+	$license = "Apple MIT $license";
+    }
+
     if ($licensetext =~ /Permission is hereby granted, free of charge, to any person or organization obtaining a copy of the software and accompanying documentation covered by this license \(the \"Software\"\)/ or
 	$licensetext =~ /Boost Software License([ ,-]+Version ([^ ]+)?(\.))/i) {
 	$license = "BSL " . ($1 ? "(v$2) " : '') . $license;
@@ -525,16 +529,8 @@ sub parselicense($) {
         $license = "libpng $license";
     }
 
-    if ($licensetext =~ /Do What The Fuck You Want To Public License, Version ([^, ]+)/i) {
-        $license = "WTFPL (v$1)";
-    }
-
-    if ($licensetext =~ /Do what The Fuck You Want To Public License/i) {
-        $license = "WTFPL";
-    }
-
-    if ($licensetext =~ /(License WTFPL|Under (the|a) WTFPL)/i) {
-        $license = "WTFPL";
+    if ($licensetext =~ /under MIT license/) {
+        $license = "MIT/X11 (BSD like) $license";
     }
 
     $license = "UNKNOWN" if (!length($license));

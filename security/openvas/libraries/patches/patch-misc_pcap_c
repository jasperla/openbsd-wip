$OpenBSD$
--- misc/pcap.c.orig	Thu Jul 31 07:40:10 2014
+++ misc/pcap.c	Wed Oct 29 20:31:52 2014
@@ -16,6 +16,10 @@
  * Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
  */
 
+#include <stdlib.h>
+#include <string.h>
+#include <unistd.h>
+#include <sys/types.h>
 #include <netinet/in.h>
 #include <resolv.h>
 #include <pcap.h>
@@ -23,10 +27,6 @@
 #include <arpa/inet.h>
 #include <sys/ioctl.h>
 #include <netdb.h>
-#include <stdlib.h>
-#include <string.h>
-#include <unistd.h>
-#include <sys/types.h>
 #include <ifaddrs.h>
 
 
@@ -655,10 +655,10 @@ getinterfaces (int *howmany)
     printf
       ("getinterfaces: SIOCGIFCONF claims you have no network interfaces!\n");
 
-  len = sizeof (struct ifmap);
+  len = 0;
 
   for (bufp = buf; bufp && *bufp && (bufp < (buf + ifc.ifc_len));
-       bufp += sizeof (ifr->ifr_name) + len)
+       bufp += sizeof (struct ifreq) )
     {
       ifr = (struct ifreq *) bufp;
       sin = (struct sockaddr_in *) &ifr->ifr_addr;

$OpenBSD$
--- libcyberjack/libdialog/dialog.c.orig	Wed Dec 30 13:51:05 2015
+++ libcyberjack/libdialog/dialog.c	Wed Dec 30 14:28:19 2015
@@ -37,6 +37,7 @@
 #include <assert.h>
 #include <stdio.h>
 
+#include "getutent.c"
 
 #ifdef OS_DARWIN
 # include <SystemConfiguration/SCDynamicStoreCopySpecific.h>
@@ -126,11 +127,9 @@ static int rsct_dialog_mk_socket() {
 
   while ((u_tmp_p = getutent()) != NULL) {
     DEBUGPI("RSCT: ut_type=%d, ut_line=[%s]\n",
-	    u_tmp_p->ut_type,
 	    u_tmp_p->ut_line);
-    if (u_tmp_p->ut_type==USER_PROCESS &&
-	(u_tmp_p->ut_line[0]!=0 && strcasecmp(u_tmp_p->ut_line, ":0")==0) &&
-	u_tmp_p->ut_user[0]!=0)
+    if ((u_tmp_p->ut_line[0]!=0 && strcasecmp(u_tmp_p->ut_line, ":0")==0) &&
+	u_tmp_p->ut_name[0]!=0)
       break;
   }
 
@@ -140,16 +139,16 @@ static int rsct_dialog_mk_socket() {
     return -1;
   }
 
-  pw=getpwnam(u_tmp_p->ut_user);
+  pw=getpwnam(u_tmp_p->ut_name);
   if (pw==NULL) {
     DEBUGPE("RSCT: Could not get home folder for user [%s]: %s (%d)\n",
-	    u_tmp_p->ut_user, strerror(errno), errno);
+	    u_tmp_p->ut_name, strerror(errno), errno);
     endutent();
     return -1;
   }
 
   if (pw->pw_dir==NULL || *(pw->pw_dir)==0) {
-    DEBUGPE("RSCT: User [%s] has no home folder\n", u_tmp_p->ut_user);
+    DEBUGPE("RSCT: User [%s] has no home folder\n", u_tmp_p->ut_name);
     endutent();
     return -1;
   }

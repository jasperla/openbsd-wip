$OpenBSD$

Index: source/source/unix/unix_net.c
--- source/source/unix/unix_net.c.orig
+++ source/source/unix/unix_net.c
@@ -26,7 +26,7 @@ Foundation, Inc., 59 Temple Place - Suite 330, Boston,
 #include <sys/param.h>
 #include <sys/ioctl.h>
 #include <sys/uio.h>
-#if !defined ( __APPLE__ )
+#if defined ( __linux__ )
 #include <sys/sendfile.h>
 #endif
 #include <errno.h>
@@ -86,9 +86,22 @@ int64_t Sys_NET_SendFile( socket_handle_t handle, int 
 	len = count;
 	ssize_t result = sendfile( fileno, handle, _offset, &len, NULL, 0 );
 	result = len;
-#else
+#elif defined ( __linux__ )
 	ssize_t result = sendfile( handle, fileno, &_offset, count );
 	len = result;
+#elif defined ( __DragonFly__ ) || defined ( __FreeBSD__ )
+	ssize_t result = sendfile( fileno, handle, _offset, count, NULL, &len, 0 );
+	result = len;
+#else
+	void *sendfilebuf = malloc(count);
+	ssize_t result = pread(fileno, sendfilebuf, count, _offset);
+
+	if (result > 0) {
+		result = write(handle, sendfilebuf, (size_t) result);
+	}
+
+	len = result;
+	free(sendfilebuf);
 #endif
 	if( result < 0 ) {
 		return result;

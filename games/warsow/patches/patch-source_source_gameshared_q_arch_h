$OpenBSD$

Index: source/source/gameshared/q_arch.h
--- source/source/gameshared/q_arch.h.orig
+++ source/source/gameshared/q_arch.h
@@ -184,12 +184,56 @@ typedef unsigned long ioctl_param_t;
 // But we don't want to include all those Windows definitions there, do we?
 typedef UINT_PTR socket_handle_t;
 
+#elif defined ( __APPLE__ ) && defined ( __MACH__ )
+
+#ifndef __MACOSX__
+#define __MACOSX__
 #endif
 
-//==============================================
+#define HAVE_INLINE
 
-#if defined ( __linux__ ) || defined ( __FreeBSD__ )
+#ifndef HAVE_STRCASECMP // SDL_config.h seems to define this too...
+#define HAVE_STRCASECMP
+#endif
 
+#define LIB_DIRECTORY "libs"
+#define LIB_PREFIX "lib"
+#define LIB_SUFFIX ".dylib"
+
+#define MUMBLE_SUPPORT
+#define OPENAL_RUNTIME
+
+// FIXME: move these to CMakeLists.txt
+#define LIBZ_LIBNAME "libz.dylib"
+#define LIBCURL_LIBNAME "libcurl.4.dylib|libcurl.3.dylib|libcurl.2.dylib"
+#define LIBPNG_LIBNAME "libpng16.16.dylib|libpng15.15.dylib|libpng14.14.dylib|libpng12.0.dylib"
+#define LIBJPEG_LIBNAME "libjpeg.62.dylib"
+#define LIBOGG_LIBNAME "libogg.0.dylib|libogg.dylib"
+#define LIBVORBIS_LIBNAME "libvorbis.dylib"
+#define LIBVORBISFILE_LIBNAME "libvorbisfile.dylib"
+#define LIBTHEORA_LIBNAME "libtheora.0.dylib|libtheora.dylib"
+#define LIBFREETYPE_LIBNAME "libfreetype.6.dylib|libfreetype.dylib"
+
+//Mac OSX has universal binaries, no need for cpu dependency
+#define BUILDSTRING "MacOSX"
+#define OSNAME "MacOSX"
+#define STEAMQUERY_OS 'o'
+#define CPUSTRING "universal"
+#define ARCH "mac"
+
+#define VAR( x ) # x
+
+#include <alloca.h>
+
+typedef int ioctl_param_t;
+
+typedef int socket_handle_t;
+
+#define SOCKET_ERROR (-1)
+#define INVALID_SOCKET (-1)
+
+#else
+
 #define HAVE_INLINE
 
 #ifndef HAVE_STRCASECMP // SDL_config.h seems to define this too...
@@ -219,21 +263,30 @@ typedef UINT_PTR socket_handle_t;
 #if defined ( __FreeBSD__ )
 #define BUILDSTRING "FreeBSD"
 #define OSNAME "FreeBSD"
+#elif defined ( __OpenBSD__ )
+#define BUILDSTRING "OpenBSD"
+#define OSNAME "OpenBSD"
+#elif defined ( __NetBSD__ )
+#define BUILDSTRING "NetBSD"
+#define OSNAME "NetBSD"
+#elif defined ( __DragonFly__ )
+#define BUILDSTRING "DragonFly BSD"
+#define OSNAME "DragonFly BSD"
 #elif defined ( __ANDROID__ )
 #define BUILDSTRING "Android"
 #define OSNAME "Android"
-#else
+#elif defined ( __linux__ )
 #define BUILDSTRING "Linux"
 #define OSNAME "Linux"
+#else
+#define BUILDSTRING "Unknown"
+#define OSNAME "Unknown"
 #endif
 
 #define STEAMQUERY_OS 'l'
 
 #ifdef __i386__
-#if defined ( __FreeBSD__ )
-#define ARCH "freebsd_i386"
-#define CPUSTRING "i386"
-#elif defined ( __ANDROID__ )
+#if defined ( __ANDROID__ )
 #define ARCH "android_x86"
 #define CPUSTRING "i386"
 #else
@@ -241,13 +294,8 @@ typedef UINT_PTR socket_handle_t;
 #define CPUSTRING "i386"
 #endif
 #elif defined ( __x86_64__ )
-#if defined __FreeBSD__
-#define ARCH "freebsd_x86_64"
-#define CPUSTRING "x86_64"
-#else
 #define ARCH "x86_64"
 #define CPUSTRING "x86_64"
-#endif
 #elif defined ( __powerpc__ )
 #define ARCH "ppc"
 #define CPUSTRING "ppc"
@@ -277,61 +325,13 @@ typedef UINT_PTR socket_handle_t;
 
 #define VAR( x ) # x
 
+#if defined ( __linux__ )
 #include <alloca.h>
-
-// wsw : aiwa : 64bit integers and integer-pointer types
-typedef int ioctl_param_t;
-
-typedef int socket_handle_t;
-
-#define SOCKET_ERROR (-1)
-#define INVALID_SOCKET (-1)
-
+#else
+#include <stdlib.h>
 #endif
 
-//==============================================
-
-#if defined ( __APPLE__ ) && defined ( __MACH__ )
-
-#ifndef __MACOSX__
-#define __MACOSX__
-#endif
-
-#define HAVE_INLINE
-
-#ifndef HAVE_STRCASECMP // SDL_config.h seems to define this too...
-#define HAVE_STRCASECMP
-#endif
-
-#define LIB_DIRECTORY "libs"
-#define LIB_PREFIX "lib"
-#define LIB_SUFFIX ".dylib"
-
-#define MUMBLE_SUPPORT
-#define OPENAL_RUNTIME
-
-// FIXME: move these to CMakeLists.txt
-#define LIBZ_LIBNAME "libz.dylib"
-#define LIBCURL_LIBNAME "libcurl.4.dylib|libcurl.3.dylib|libcurl.2.dylib"
-#define LIBPNG_LIBNAME "libpng16.16.dylib|libpng15.15.dylib|libpng14.14.dylib|libpng12.0.dylib"
-#define LIBJPEG_LIBNAME "libjpeg.62.dylib"
-#define LIBOGG_LIBNAME "libogg.0.dylib|libogg.dylib"
-#define LIBVORBIS_LIBNAME "libvorbis.dylib"
-#define LIBVORBISFILE_LIBNAME "libvorbisfile.dylib"
-#define LIBTHEORA_LIBNAME "libtheora.0.dylib|libtheora.dylib"
-#define LIBFREETYPE_LIBNAME "libfreetype.6.dylib|libfreetype.dylib"
-
-//Mac OSX has universal binaries, no need for cpu dependency
-#define BUILDSTRING "MacOSX"
-#define OSNAME "MacOSX"
-#define STEAMQUERY_OS 'o'
-#define CPUSTRING "universal"
-#define ARCH "mac"
-
-#define VAR( x ) # x
-
-#include <alloca.h>
-
+// wsw : aiwa : 64bit integers and integer-pointer types
 typedef int ioctl_param_t;
 
 typedef int socket_handle_t;
